{% extends 'base.html' %}
{% load humanize %}

{% block title %}
  {{ post.subreddit.name }}
{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item"><a href="{% url 'home' %}">Reddit</a></li>
  <li class="breadcrumb-item"><a href="{% url 'subreddits' %}">Subreddits</a></li>
  <li class="breadcrumb-item"><a href="{% url 'subreddit_posts' post.subreddit.name %}">{{ post.subreddit.name }}</a></li>
  <li class="breadcrumb-item active">{{ post.subject }}</li>
{% endblock %}


{% block content %}

    {% if request.user.is_authenticated %}
    <div class="mb-4">
      <a href="{% url 'comment_new' post.subreddit.name post.pk %}" class="btn btn-primary">New comment</a>
    </div>
    {% else %}
    {% endif %}

     {% for comment in post.comments.all %}
      <div class="card mb-2">
        {% if forloop.first %}
          <div class="card-header text-white bg-dark py-2 px-3"></div>
        {% endif %}
        <div class="card-body p-3">
            <div class="col-10">
              <p>Comment: {{ comment }}</p>
              <small>By: {{comment.created_by.username}}</small>
              <p><small>Last updated: {{comment.updated_at|naturaltime}}</small></p>

              {% if request.user.is_authenticated and request.user == comment.created_by %}
              <div class="mb-4">
                  <a href="{% url 'comment_update' post.subreddit.name post.pk comment.pk %}" class="btn btn-primary">Edit comment</a>
              </div>
              <div class="mb-4">
                  <a href="{% url 'comment_reply' post.subreddit.name post.pk comment.pk %}" class="btn btn-primary">Reply comment</a>
              </div>
              {% else %}
              {% endif %}

            </div>
        </div>
      </div>

    {% while comment.ref_comment != null %}
      <div class="card-body p-4">
        <div class="col-10">
          <p>Comment: {{ ref_comment }}</p>
          <small>By: {{ref_comment.created_by.username}}</small>
          <p><small>Last updated: {{ref_comment.updated_at|naturaltime}}</small></p>

          {% if request.user.is_authenticated and request.user == comment.created_by %}
          <div class="mb-4">
              <a href="{% url 'comment_update' post.subreddit.name post.pk ref_comment.pk %}" class="btn btn-primary">Edit comment</a>
          </div>
          <div class="mb-4">
              <a href="{% url 'comment_reply' post.subreddit.name post.pk ref_comment.pk %}" class="btn btn-primary">Reply comment</a>
          </div>
          {% else %}
          {% endif %}

        </div>
    </div>

    {% endwhile %}

  {% endfor %}

{% endblock %}





